<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cc="http://java.sun.com/jsf/composite">
    <cc:interface componentType="imageEditorComponent">
        <cc:attribute name="defaultImageUrl"
                      type="java.lang.String"
                      shortDescription="Default image URL to show when there is not image setted"/>
        <cc:attribute name="imageUrl"
                      type="com.hallocasa.commons.vo.ImageContainer"
                      required="false"
                      shortDescription="Image URL to edit"/>
        <cc:attribute name="imageType"
                      type="java.lang.String"
                      default="image"
                      shortDescription="Image type as scheme to manage image files"/>
        <cc:attribute name="readOnly"
                      type="java.lang.Boolean"
                      default="false"
                      shortDescription="Indicates image only must be showed, but not edited"/>
    </cc:interface>
    <cc:implementation>
       
        
        <div class="hc-overlay-form-buttons-container">
            <h:commandButton 
                rendered="#{not cc.attrs.readOnly}"
                value="#{viewBundle['Image.Edition']}"
                onclick="PF('upload-image-dialog').show();return false"/>
        </div>
        <div class="hc-responsive-div">
            <h:graphicImage  
                url="#{cc.attrs.imageUrl.url}"/>
        </div>
        
        
        <p:dialog header="#{viewBundle['Image.Edition.Header']}" 
                  position="center"
                  widgetVar="upload-image-dialog" 
                  minHeight="40" 
                  width="800"
                  height="500"
                  draggable="false"
                  resizable="false">
            <h:panelGroup id="upload-image-bt"
                          styleClass="hc-padding-20">
                <div class="hc-overlay-form-buttons-container"
                     style="float:right">
                    <h:commandButton 
                        value="#{viewBundle['Common.Label.Back']}"
                        action="#{cc.onBackClick}"
                        rendered="#{cc.showBackButton}"
                        styleClass="hc-basic-button hc-go-right">
                        <f:ajax 
                            render="upload-image-pg upload-image-bt" />
                    </h:commandButton>
                    <h:commandButton 
                        value="#{viewBundle['Common.Label.Next']}"
                        action="#{cc.onNextClick}"
                        rendered="#{cc.showNextButton}"
                        styleClass="hc-basic-button hc-go-right"
                        >
                        <f:ajax 
                            render="upload-image-pg upload-image-bt"
                            />
                    </h:commandButton>
                </div>
            </h:panelGroup>
            <h:panelGroup id="upload-image-pg"
                          styleClass="hc-300-panel">
                <h:panelGroup 
                    rendered="#{cc.showImageLoad}">
                    <h:outputText 
                        value="#{viewBundle['Image.Edition.Header.Detail']}"/>
                    <br/><br/>
                    <h:inputFile 
                        id="file"
                        value="#{cc.uncroppedImagePart}"
                        styleClass="hc-basic-button"
                        validator="#{cc.validateFile}">
                    </h:inputFile>
                    <br/><br/>
                    <div class="hc-overlay-form-buttons-container" >
                        <h:commandButton 
                            value="#{viewBundle['Image.Edition.Header.Upload']}"
                            action="#{cc.onFileUpload}"
                            styleClass="hc-basic-button hc-go-right">
                            <f:ajax 
                                execute="file"
                                render="upload-image-pg upload-image-bt" />
                        </h:commandButton>
                    </div>
                </h:panelGroup>
                <h:panelGroup 
                    rendered="#{cc.showImageCrop}">
                    <h:outputText 
                        value="#{viewBundle['Image.Edition.Crop']}"/>
                    <br/><br/>
                    <h:panelGrid columns="2">
                        <div class="hc-overlay-form-buttons-container">
                           <h:commandButton 
                                value="#{viewBundle['Image.Edition.FinishCrop']}"
                                action="#{cc.onImageCrop}"
                                style="float:left"
                                styleClass="hc-basic-button">
                                <f:ajax 
                                    execute="cropper"
                                    render="@form" />
                           </h:commandButton> 
                        </div>
                        <p:imageCropper 
                            id="cropper"
                            value="#{cc.croppedImage}" 
                            image="/resources/images/#{cc.uncroppedImageResourcesUrl}" 
                            initialCoords="0,0,50,50"/>
                    </h:panelGrid>
                </h:panelGroup>
            </h:panelGroup>
            
        </p:dialog>
    </cc:implementation>
</ui:composition>